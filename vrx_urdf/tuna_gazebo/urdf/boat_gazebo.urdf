<?xml version="1.0"?>
<robot name="tuna">

  <!-- Base link with your boat mesh -->
  <link name="base_link">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/> <!-- LOWERED CENTER OF MASS -->
      <mass value="3.0"/>
      <inertia ixx="0.2" iyy="0.2" izz="0.2" ixy="0" ixz="0" iyz="0"/>
    </inertial>

    <!-- Your boat visual mesh -->
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://tuna_gazebo/meshes/boat.dae"/>
      </geometry>
    </visual>
  </link>




  <!-- Left propeller with mesh -->
  <link name="prop_left">
    <inertial>
      <!-- origin xyz="0 0 0" rpy="0 0 0"/ -->
      <origin xyz="0 0 0" rpy="1.52 0 0" />
      <mass value="1.0"/>
      <inertia ixx="0.0001" iyy="0.0001" izz="0.0001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>

      <geometry>
        <mesh filename="package://tuna_gazebo/meshes/prop_left.dae"/>
      </geometry>

    </visual>
  </link>

  <!-- Right propeller with mesh -->
  <link name="prop_right">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="1.0"/>
      <inertia ixx="0.0001" iyy="0.0001" izz="0.0001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>

      <geometry>
        <mesh filename="package://tuna_gazebo/meshes/prop_right.dae"/>
      </geometry>

    </visual>
  </link>

  <!-- Joints -->



  <joint name="base_to_prop_right" type="continuous">
    <parent link="base_link"/>
    <child link="prop_right"/>
    <origin xyz="-0.14 -0.018 -0.043" rpy="0 -0.19 0"/>
    <!-- axis xyz="1 0 0"/ -->
    <axis xyz="0 1 0" />
  </joint>

  <joint name="base_to_prop_left" type="continuous">
    <parent link="base_link"/>
    <child link="prop_left"/>
    <origin xyz="-0.14 0.018 -0.043" rpy="0 -0.19 0"/>
    <!-- axis xyz="1 0 0"/ -->
    <axis xyz="0 1 0" />
  </joint>

  <!-- VRX SURFACE PLUGIN - This makes it float -->
  <gazebo>
    <plugin filename="libSurface.so" name="vrx::Surface">
      <link_name>base_link</link_name>
      <hull_length>2.0</hull_length>
      <hull_radius>0.25</hull_radius>
      <fluid_level>0</fluid_level>
      <points>
        <point>1.0 0.25 0</point>
        <point>1.0 -0.25 0</point>
        <point>-1.0 0.25 0</point>
        <point>-1.0 -0.25 0</point>
      </points>
      <wavefield>
        <topic>/vrx/wavefield/parameters</topic>
      </wavefield>
    </plugin>
  </gazebo>

  <!-- ADD WAVE CONTROL PARAMETERS -->
  <gazebo>
    <plugin filename="libWavefieldVisualPlugin.so" name="wavefield_visual">
      <static>false</static>
      <update_rate>30</update_rate>
      <size>1000 1000</size>
      <cell_count>50 50</cell_count>
      
      <!-- LOWER WAVE PARAMETERS -->
      <wave>
        <model>PMS</model>
        <period>20.0</period>      <!-- Longer period = gentler waves -->
        <amplitude>0.01</amplitude><!-- Lower amplitude = smaller waves -->
        <number>3</number>
        <scale>1.5</scale>
        <gain>0.5</gain>          <!-- Lower gain = calmer waves -->
        <direction>1 0</direction>
        <angle>0.4</angle>
        <tau>2.0</tau>
        <amplitude_rate>0.01</amplitude_rate>
      </wave>
    </plugin>
  </gazebo>

  <!-- === TF === -->
  <!-- Publish robot state information -->
  <gazebo>
    <plugin filename="libgz-sim-pose-publisher-system.so"
      name="gz::sim::systems::PosePublisher">
      <publish_link_pose>false</publish_link_pose>
      <publish_sensor_pose>true</publish_sensor_pose>
      <publish_collision_pose>false</publish_collision_pose>
      <publish_visual_pose>false</publish_visual_pose>
      <publish_nested_model_pose>false</publish_nested_model_pose>
      <publish_model_pose>false</publish_model_pose>
      <use_pose_vector_msg>true</use_pose_vector_msg>
      <static_publisher>false</static_publisher>
      <static_update_frequency>1</static_update_frequency>
    </plugin>

    <plugin
      filename="gz-sim-joint-state-publisher-system"
      name="gz::sim::systems::JointStatePublisher">
    </plugin>
  </gazebo>
  <ros2_control name="MobileBaseHardwareInterface" type="system">
        <hardware>
            <plugin>mock_components/GenericSystem</plugin>
            <param name="calculate_dynamics">true</param>
        </hardware>
        <joint name="base_to_prop_right">
            <command_interface name="velocity" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="base_to_prop_left">
            <command_interface name="velocity" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
  </ros2_control>
</robot>